# 为什么要用 Virtual Dom

本篇文章将展示的内容有如下：

- 为什么说操作 dom 是昂贵的
- 为什么使用 vdom

## 为什么说 dom 操作是昂贵的

### 访问节点属性

在讲解这一点前需要了解的就是浏览器会维护一个 flush 队列，这个队列中会存放那些会引起重排和重绘的操作放到这个队列中，当这个队列中的任务数量到达某个值或者到达一定的时间段，浏览器会处理 flush 中的任务，将页面更新。这样让原本需要多次重排或重绘的任务变成只需要一次重排或重绘完成。

回到主题，当使用 js 获取节点属性的时候，浏览器为了给出精确的值，就会去更新 flush 队列中的任务，然后将算出的值返给 js。所以当使用 js 获取节点属性的时候就有可能会导致页面的重排或者重绘。

### dom 设置

当使用 js 去删除节点获取修改节点的样式属性的时候就会出现重排或者重绘情况的发生。

## 为什么使用 vdom

这里假设我们有一个列表，并且列表中的子元素的个数或者发生改变。

或者是列表元素类型发生改变。

1、笨方法是一个一个的遍历数组然后将子节点渲染出来；使用 vdom 浏览器页面更新使用一次重排或者重绘；实际上也可以将所有的子节点添加到一个游离节点上，然后在将游离节点写入页面，这样也可以实现一次重排

2、使用声明式编程，vdom 使用者不需要去考虑更新 dom 的具体步骤，只需要将最终想要渲染出来的结果当成参数传入就行。

声明式编程：告诉‘机器’你想要什么，后面‘机器’如何实现的不需要我们去了解。

命令式编程：告诉‘机器’如何去做事，每一步该干嘛我们都需要命令‘机器’去做。

3、计算哪些节点内容需要修改，这样就减少了不必要的渲染。