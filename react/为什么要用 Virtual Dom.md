# 为什么要用 Virtual Dom

本篇文章将展示的内容有如下：

- 为什么说操作 dom 是昂贵的
- 为什么使用 vdom

## 为什么说 dom 操作是昂贵的

### 访问节点属性

在讲解这一点前需要了解的就是浏览器会维护一个 flush 队列，这个队列中会存放那些会引起重排和重绘的操作放到这个队列中，当这个队列中的任务数量到达某个值或者到达一定的时间段，浏览器会处理 flush 中的任务，将页面更新。这样让原本需要多次重排或重绘的任务变成只需要一次重排或重绘完成。

回到主题，当使用 js 获取节点属性的时候，浏览器为了给出精确的值，就会去更新 flush 队列中的任务，然后将算出的值返给 js。所以当使用 js 获取节点属性的时候就有可能会导致页面的重排或者重绘。

### dom 设置

当使用 js 去删除节点获取修改节点的样式属性的时候就会出现重排或者重绘情况的发生。

## 为什么使用 vdom

下面将同时展示 vdom 的优点和缺点

### 优点：

1、使用声明式编程，vdom 使用者不需要去考虑更新 dom 的具体步骤，只需要将最终想要渲染出来的结果当成参数传入就行。如果框架没有 bug，那么程序出错的概率就会减少，同时减少维护成本。

声明式编程：告诉‘机器’你想要什么，后面‘机器’如何实现的不需要我们去了解。

命令式编程：告诉‘机器’如何去做事，每一步该干嘛我们都需要命令‘机器’去做。

2、重复渲染时以最小的代价更新 dom，配合 diff 算法，在内存中计算节点有什么变化，然后根据变化来更新 dom。

3、进行跨平台开发，将 dom 抽象化，然后由框架底层使用各个平台的方式来对 dom 进行渲染

### 缺点：

1、需要消耗一部分的内存来对 vdom 进行存储，同时递归计算真实 dom 和 vdom 之间的变化时也需要消耗一部分性能。

## 学习地址

[知乎的问题网上都说操作真实 DOM 慢，但测试结果却比 React 更快，为什么？](https://www.zhihu.com/question/31809713)

[知乎的问题：既然用 virtual dom 可以提高性能，为什么浏览器不直接自带这个功能呢？](https://www.zhihu.com/question/67479886)

