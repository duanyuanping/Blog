## 错误监控
RN中的错误分别有js错误和native错误。
可以使用`react-native-exception-handler`工具可以快速实现错误监控。

### js错误监控
Error对象上主要有name、message、stack这三个有用的属性。
- name：错误的类型
- message：错误提示信息
- stack：错误栈
我们可以使用Error.prototype.toString快速获取name+message的错误信息字符串。

#### try...catch
```
try {
  throw new Error('test');
} catch (error) {
  handleError(error); // handleError是自定义错误信息处理函数
}
```
#### global.ErrorUtils
```
// 存放原始的错误处理函数
const errorHandle = global.ErrorUtils.getGlobalHandler();

global.ErrorUtils.setGlobalHandler(handleError, true); // handleError是自定义错误信息处理函数
```

#### handleError
```
function lsErrorStack(e) {
  if (!e || !e instanceof Error || !e.stack) return {};

  try {
    const stack = e.stack.toString().split(/\r\n|\n/), frameRE = /:(\d+:\d+)[^\d]*$/;
    
    while (stack.length) {
      const frame = frameRE.exec(stack.shift())
      if (frame) {
        const position = frame[1].split(':')
        return { line: position[0], column: position[1] };
      }
    }
  } catch () {
    return {}
  }
}

function handleError(e, isFatal) {
  const position = lsErrorStack(e);
  
  // 上报错误信息：e.toString()； position；等信息
  report(...)
}
```

#### 未捕获的promise错误
RN源码中就有监控未捕获的promise错误的代码，我们可以将代码ctl+c、ctl+v，并注意在非开发环境下监控
```
if (!__DEV__) {
  require('promise/setimmediate/rejection-tracking').enable({
    allRejections: true,
    onUnhandled: (id, error) => {
      // 错误信息上报
    },
    onHandled: (id) => {},
  });
}
```

### navive错误监控
[rn原生模块-android](https://reactnative.cn/docs/native-modules-android)

[rn原生模块-ios](https://reactnative.cn/docs/native-modules-ios)

[react-native-exception-handler](https://www.npmjs.com/package/react-native-exception-handler)

## 性能监控
- bundle资源加载时间
- 首屏渲染时间
- 图片资源加载时间
- cgi耗时: fetch函数重写






