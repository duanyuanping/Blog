# 简介

## nginx是一个反向代理服务器

#### 正向代理

假设A是普通用户，B是资源服务，C是代理服务。

A想要获取B服务上面的资源，但是A无法直接请求B（例如：国内的“墙”）或者不想被B拿到A的一些个人信息（例如：在某个平台口嗨，不想被平台查到自己ip地址等）。代理过程：A向C发起资源请求，C向B服务请求相同的资源，**C拿到B服务资源后返回给A**。

正向代理特点：  
1、资源服务无法拿到用户的真实ip，只能拿到代理服务的ip。 
2、用户知道资源服务的真实地址。  
3、用户可以请求到限制性资源服务的内容。前提是用户能够成功请求到代理服务，并且代理服务能够请求到资源服务。例如各种vpn。

#### 反向代理

假设A是普通用户，B是资源服务，C是代理服务。

A不知道B服务的地址是多少，但是C知道B服务的地址。代理过程：A直接请求C服务，C通过代理配置（proxy_pass）将A的这次请求转发到B服务上，然后**B服务自己响应A的这次请求**。

反向代理特点：  
1、降低资源服务被攻击的频率，用户只知道代理服务的地址，不知道真实的资源服务，无法直接对资源服务进行攻击。内容提供方可以在代理服务上提前做一些屏蔽恶意的请求等防御措施。  
2、用户不知道资源服务的真实地址，资源服务知道用户的地址。

## 负载均衡服务器

nginx是反向代理服务器，代理服务将所有用户的请求转发到真实的资源服务。nginx内置的负载均衡策略有3种，分别如下：
- 轮询
  - 默认（权重都为1）  
  nginx将所有请求均匀的分给每台服务器。假设有3台服务器，分别为a、b、c，nginx将这次请求分给a以后，下次请求就分给b，再下次分给c，以此类推。
  - 加权（weight）  
  nginx根据各台服务器的加权配置，将请求按照顺序分配给服务器。假设有3台服务器，分别为a（加权为1）、b（加权为2）、c（加权为1），nginx将这次请求分给a，后面2次都分给b，再后面第3次请求分给c处理，以此类推。
- 最少连接数  
  nginx将本次请求分配给所有服务器中connect/weight最小的服务。
- ip_hash
  nginx获取请求的ip，根据ip计算出相应的hash，然后分配到一台服务器上，后面算出来相同的hash值的请求会被nginx分配到之前相同的服务器上。

## 安装

### mac
安装：`brew install nginx`   
配置目录：`/usr/local/etc/nginx`

### centos
安装：`yum install -y nginx`     
配置目录：`/etc/nginx` 

