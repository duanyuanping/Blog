项目初始步骤：
- 配置项目jsonSchema（项目基础信息、项目模板、工具服务）
- 插件初始化工作
  - 判断项目中使用的插件是否已经安装，初始相关依赖
  - 插件内部耗时任务，先执行（数据上报相关，上报项目id新建）
- 执行渲染任务
  - 读取插件文件内容，并使用ejs向模版文件写入数据
  - 生成项目文件
- git操作
  - 对应的gitGroup下创建项目
  - 代码上传
  - 项目成员写入
  - ci工具接入（如果有用的话）

项目初始过程会用到两类插件：项目模板插件、工具服务插件。  
插件安装方式：
- 项目模板：只支持npm安装方式
- 工具服务：支持npm和cdn连接引入两种方式（平台建议工具服务两种方式都提供，引用方式需要工具服务来支持），服务端只支持npm方式

## 插件初始化
### 插件环境安装
判断服务器根目录是否已经安装当前使用的插件，如果不存在，就安装相应的插件。
### 插件初始脚本执行
执行插件根目录下的渲染函数，如果插件不依赖其他服务中的数据，就可以调用cli的渲染函数，并将插件渲染所需的数据传入。如果插件渲染依赖其他服务，我们可以在插件渲染函数中执行额外操作，例如tam，在项目初始过程中我们需要为项目申请一个id，就需要向请求tam创建项目服务，当tam项目创建成功后，再执行cli渲染函数，并将插件初始需要的数据和插件执行依赖的包信息传入。

插件脚本执行以后，调用cli提供的写入渲染任务函数，将当前插件的数据（模版数据、当前插件使用包、安装方式）（通过闭包缓存）和渲染任务（数组变量存放）都存起来。

## 执行渲染任务
脚本初始完以后，会将对应的脚本渲染任务都写入到cli中的一个数组变量中，本轮需要运行这些任务。

### 读取插件文件内容，并使用ejs向模版文件写入数据
遍历获取相应插件中的`generator/template`所有文件路径，分别读取这些文件内容，对于模版文件，使用ejs将数据填充到文件中（例如tam模版文件需要依赖插件初始获取到的tamId），然后将内容存放到数组变量中。

### 生成项目文件
- 依赖安装
  - npm：依赖写入package.json
  - html：依赖写入index.html
- middle-server中的插件引用

web项目中，部分工具服务可以通过sdk和npm这两种方式引入插件资源文件。当项目开始渲染时，需要将这两种安装方式的插件分离。
- 当存放index.html模版文件前，使用script标签一次加载插件的sdk资源。这里使用jsdom将文档转成可以使用dom操作的文本，script可以插到head或者body标签中，由于插件之前可能存在依赖关系，这里提供一个权重功能，权重高插入的位置就比权重低的插件要更靠前。
- 当存放package.json前，需要将插件初始过程中传入的插件依赖信息写入项目中的dependence属性中。

middle-server插件调用：  
获取middle-service目录下的所有文件，依次遍历生成插件引用代码（例如`import './tam'`），在middle-service中新建一个index.js文件，并将刚生成的插件引用代码写入，在项目模板中的入口文件引入middle-service中index.js文件。


## 存在的问题
1. 项目初始过程会将项目模版、插件模版这些代码都一起读到内存中，这就导致内存占用升高，当多个用户同时请求项目初始服务的时候，可能导致服务崩溃。  
解决方案：各插件和项目模版初始、渲染过程分离，都独立运行。插件代码、项目模版代码都写入到项目中以后，再统一修改index.html（引入插件sdk）、package.json（插入插件依赖）、middle-service/index.js（插件引用文件）、index.js（项目入口文件）