## HTTP1
每次请求都需要建立一个TCP连接，当请求处理完成后立即断开连接。如果一个网页请求多张图片，那么每条请求连接都是独立运行的，每次都要去建立tcp连接（建立tcp连接是比较耗时的）。

客户端依据域名向服务器建立连接，pc浏览器允许对单个域名服务器同时建立6-8个连接，而手机端之后4-6个。

## HTTP1.1
### 持久连接
http1.1支持在同一条tcp连接上传输多个http请求和响应，减少了连接和断开的消耗和延迟。如果一个网页请求多张图片，那么同域名的图片是可以在同一条连接上进行请求和响应的。但是，两个页面的请求连接还是独立分开的。http1.1允许上一个请求还没有收到响应前，可以发送另一条请求到服务器，但是服务器端还是需要依据请求到达的先后来一次处理请求，以保证客户端能够正常区分当前响应属于那条请求的。

http1.1增加了一个`connection`请求头，如果想要使用持久连接，就需要在请求头中设置`connection: keep-alive`。如果客户端或者服务端一方设置`connection: close`，那么本次连接请求完成以后就会立即断开。

### 存在问题
- http队头阻塞
虽然http1.1支持持久化连接和管道连接，但是同一条tcp连接，发出多个请求到达服务器应用层时，会被放到一个请求队列中，只有当服务器处理响应队头请求后，才能进行下一个请求处理，这就导致了http队头阻塞。

## HTTP2
### 二进制分帧
应用层和传输层之间添加了一个二进制分帧层，应用层http2传输数据会被分割成更小的消息和帧，并对他们使用二进制编码。http head会被封装到Headers帧，http body会被封装到Data帧。
![](http://www.linuxidc.com/upload/2015_08/150826074396731.jpg)

### 头部压缩
http2客户端和服务端都会使用一个“头部表”，用来存放之前消息头中发送过的键值对，如果后续请求响应头和之前是一样的，那么数据传输过程就不包含头部，因此头部的开销就是0字节。
如果消息头有变化，http2只会将发生变化的数据放到Headers帧中，同时会更新到“首部表”中，服务端和客户端都会同步更新本地存放的“首部表”。

### 多路复用
http2允许客户端使用同一条tcp连接同时发出多个请求给服务器。

![](https://pic2.zhimg.com/80/b1e608ddb7493608efea3e76912aabe1_hd.png)

http1.x消息传输是基于文本来进行传输的，这些文本必须按照文本的顺序串联进行传输，不然数据接收方不知道这些文本的顺序如何。http2中，每条请求都是一个单独的流，http2最小单位是帧，每个帧头部都会标明当前属于那个流，在流上的顺序是怎样的，一次数据接收方在收到数据帧以后，就可以将这些帧正确的组装成数据。

### 服务器推送
服务器对同一请求可以推送多个响应。

服务器在接受到请求时，分析出客户端可能还需要哪些资源，然后利用刚使用的tcp连接将推算出的这些资源推送给客户端。

### 存在的问题
- tcp队头阻塞
虽然http2依靠流、帧解决了http队头阻塞问题，但是传输层还是使用tcp协议。tcp会将单个数据拆分成多个按照顺序排列的数据包，这些包通过网络请求，接收方再按照顺讯将这些数据包合并，这样就得到了原始传输数据。但是，如果在网络传输过程中有一个数据包一直没有到达接收端，接受端tcp就会一直保持连接等待数据包的到来，这个时候就阻塞了后面请求的处理，就造成tcp队头阻塞。

既然tcp存在队头阻塞，那是否可以升级tcp协议？  
如果升级tcp协议，不仅仅只升级浏览器底层和服务器底层tcp协议就行了。我们使用http进行网络请求过程，会经历许多网络中间设备，这些中间设备也同样需要升级，同时目前各个行业都有使用tcp协议，因此，要达到这么大规模升级tcp协议不太现实。

## http3（quic）
http3不再使用tcp协议，传输层使用的quic协议（quic协议是基于udp实现的）。

http3使用底层使用udp协议，udp协议是面向包传递，一次不存在对头阻塞问题。

udp是不可靠传输协议，quic在udp基础上错了一些修改，使其拥有与tcp相似的可靠性，提供了数据包重传、拥塞控制、调整传输节奏等一些tcp中的特性。

## https


- [如何优雅的谈论HTTP／1.0／1.1／2.0](https://www.jianshu.com/p/52d86558ca57)
- [浅析HTTP/2的多路复用](https://segmentfault.com/a/1190000011172823)
- [HTTP/2做错了什么？刚刚辉煌2年就要被弃用了！？](https://mp.weixin.qq.com/s?__biz=MzI3NzE0NjcwMg==&mid=2650149026&idx=1&sn=86d460045bce89d72289de8ad389aa46&chksm=f3680d83c41f8495992aae7b4a45de5e7783e2af26ae59d89e29262dd55e2e10f9fda5274ffa&scene=21#wechat_redirect)
- [Google、Facebook等均开始支持的HTTP3到底是个什么鬼？](https://zhuanlan.zhihu.com/p/338560677)